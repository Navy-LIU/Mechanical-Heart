# 需求文档

## 介绍

这是一个基于Python的多用户聊天室网站项目。网站允许多个用户同时在线聊天，并集成了AI虚拟用户。AI使用月之暗面(Moonshot)的API，当用户通过@AI的方式提及时，AI会自动响应并参与对话。这创造了一个人机混合的聊天环境。

## 需求

### 需求 1

**用户故事：** 作为网站访问者，我希望能够加入聊天室与其他用户实时聊天，以便进行社交交流。

#### 验收标准

1. 当用户访问网站时，系统应显示聊天室界面
2. 当用户输入昵称并加入聊天室时，系统应通知其他用户有新用户加入
3. 当用户发送消息时，系统应实时广播给所有在线用户
4. 当用户离开聊天室时，系统应通知其他用户该用户已离开

### 需求 2

**用户故事：** 作为用户，我希望能够看到所有用户的聊天消息和完整的聊天历史，以便了解对话上下文。

#### 验收标准

1. 当用户加入聊天室时，系统应显示最近的聊天历史记录
2. 当任何用户发送消息时，系统应实时显示在所有用户的聊天界面中
3. 当消息较多时，系统应提供滚动功能查看历史消息
4. 当用户刷新页面时，系统应保持聊天历史的连续性

### 需求 3

**用户故事：** 作为用户，我希望能够通过@AI的方式与AI虚拟用户互动，以便获得智能回复和帮助。

#### 验收标准

1. 当用户在消息中使用@AI格式时，系统应识别这是对AI的提及
2. 当AI被@时，系统应调用月之暗面API获取AI回复
3. 当收到API响应时，系统应以AI用户身份发送回复消息
4. 当API调用失败时，系统应以AI身份发送错误提示消息

### 需求 4

**用户故事：** 作为用户，我希望能够看到在线用户列表，以便了解当前聊天室的参与者。

#### 验收标准

1. 当用户加入聊天室时，系统应在用户列表中显示该用户
2. 当用户离开时，系统应从用户列表中移除该用户
3. 当查看用户列表时，系统应显示AI作为特殊的虚拟用户
4. 当用户状态变化时，系统应实时更新用户列表

### 需求 5

**用户故事：** 作为用户，我希望网站界面简洁美观且支持实时通信，以便获得良好的聊天体验。

#### 验收标准

1. 当用户访问网站时，系统应显示响应式设计的聊天室界面
2. 当消息发送和接收时，系统应提供实时通信功能（WebSocket）
3. 当用户与界面交互时，系统应提供流畅的用户体验
4. 当在不同设备上访问时，系统应适配移动端和桌面端显示

### 需求 6

**用户故事：** 作为系统管理员，我希望能够安全地管理API密钥和用户连接，以便保护系统安全和稳定性。

#### 验收标准

1. 当系统启动时，系统应从环境变量中安全读取月之暗面API密钥
2. 当处理API请求时，系统应确保API密钥不会暴露给客户端
3. 当用户连接数过多时，系统应能够处理并发连接
4. 当出现异常时，系统应记录日志并优雅处理错误